import{_ as s,n as a,m as e,a5 as i}from"./chunks/framework.CIhFt3g5.js";const g=JSON.parse('{"title":"SSL错误分析报告","description":"","frontmatter":{},"headers":[],"relativePath":"3.Build/1.Python/SSL.md","filePath":"3.Build/1.Python/SSL.md"}'),t={name:"3.Build/1.Python/SSL.md"},n=i(`<h1 id="ssl错误分析报告" tabindex="-1">SSL错误分析报告 <a class="header-anchor" href="#ssl错误分析报告" aria-label="Permalink to &quot;SSL错误分析报告&quot;">​</a></h1><p>本文撰写于<code>2024年4月20日的凌晨</code>，凌晨3点半终于解决了问题，特此记录。</p><p>如果您的Python以及所有库都使用最新版本，那么你会发现，程序在执行Login操作时会出现SSL错误。</p><p>测试URL(校内网):<code>https://ismu.shmtu.edu.cn:8443/</code></p><h2 id="复现错误" tabindex="-1">复现错误 <a class="header-anchor" href="#复现错误" aria-label="Permalink to &quot;复现错误&quot;">​</a></h2><p>您可以通过下面的命令查看学校的SSL证书</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -connect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ismu.shmtu.edu.cn:8443</span></span></code></pre></div><p>本文撰写于<code>2024年4月20日的凌晨</code>，我查看学校的认证服务器的证书， 发现证书的签发日期<code>2024年3月14日</code>证书还是比较新的，因此不会是SSL证书过期的问题。</p><p>但是当使用Request库执行下面的代码时，会出现SSL错误。</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://ismu.shmtu.edu.cn:8443/&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requests.get(url)</span></span></code></pre></div><p>查询网上的解决方案均推荐使用下面的代码：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">requests.packages.urllib3.util.ssl_.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEFAULT_CIPHERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ALL&quot;</span></span></code></pre></div><p>然而却提示下面的错误</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>cannot import name &#39;DEFAULT_CIPHERS&#39; from &#39;urllib3.util.ssl_&#39;</span></span></code></pre></div><h2 id="问题分析" tabindex="-1">问题分析 <a class="header-anchor" href="#问题分析" aria-label="Permalink to &quot;问题分析&quot;">​</a></h2><p>并且只有在Python 3.10以及更高版本会出现，Python 3.9以及更低版本不会出现。</p><p>我创建了多个Conda虚拟环境，Python版本从3.8一直到最新的3.12， 发现只有3.10以及更高版本会出现SSL错误。</p><p>查询资料得知，Python 3.10以及更高版本的SSL库有了一些变化， 此外Request库到现在(2024年4月20日)， 最近的两次更新分别为<code>2.31.0 (2023-05-22)</code>与<code>2.30.0 (2023-05-03)</code>， 其中<code>2.30.0 (2023-05-03)</code>刚刚添加了<code>urllib3 2.0</code>的支持， 因此，可能这其中存在许多不兼容问题。</p><h2 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h2><h3 id="降低python版本-最简单" tabindex="-1">降低Python版本(最简单) <a class="header-anchor" href="#降低python版本-最简单" aria-label="Permalink to &quot;降低Python版本(最简单)&quot;">​</a></h3><p>然而，旧版本Python性能较差，而且不支持新的特性，因此不推荐。</p><h3 id="降低urllib3的版本" tabindex="-1">降低urllib3的版本 <a class="header-anchor" href="#降低urllib3的版本" aria-label="Permalink to &quot;降低urllib3的版本&quot;">​</a></h3><p>使用<code>pip</code>安装<code>requests</code>时，可以指定<code>urllib3</code>的版本。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> requests</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;urllib3&lt;2&quot;</span></span></code></pre></div><p>或者</p><p><code>requirements.txt</code>中这样编写:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>requests</span></span>
<span class="line"><span>urllib3&lt;2</span></span></code></pre></div><h2 id="reference" tabindex="-1">Reference <a class="header-anchor" href="#reference" aria-label="Permalink to &quot;Reference&quot;">​</a></h2><p><a href="https://github.com/JurajNyiri/pytapo/issues/65" target="_blank" rel="noreferrer">https://github.com/JurajNyiri/pytapo/issues/65</a></p><p><a href="https://github.com/psf/requests/issues/6443" target="_blank" rel="noreferrer">https://github.com/psf/requests/issues/6443</a></p><p><a href="https://github.com/psf/requests/blob/main/HISTORY.md#2300-2023-05-03" target="_blank" rel="noreferrer">https://github.com/psf/requests/blob/main/HISTORY.md#2300-2023-05-03</a></p>`,31),p=[n];function l(h,o,r,d,c,u){return e(),a("div",null,p)}const b=s(t,[["render",l]]);export{g as __pageData,b as default};
